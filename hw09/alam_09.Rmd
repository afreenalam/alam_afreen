---
title: "HW 09: Data Wrangling Graphical Analysis"
author: "Afreen Alam"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load libraries

```{r}
library(tidyverse)
library(here)
library(knitr)
library(smatr)
```

Source your functions

```{r}
my_functions <- source(here("scripts", "my_functions.R"))
```


***
### Darters in riffles

*Import data*

Read in darters.csv. These are the same data as an earlier assignment but in csv format.
Use filter() to remove tetrazonum and zonale.
Do not delete the minsub column like you did in the previous assignment.


```{r}
darters_data <- read_csv(here("data", "darters.csv"))
darters_data <- filter(darters_data, species != "tetrazonum" & species != "zonale")
darters_data
```


*Wrangle data*

Use mutate() to perform these wrangling tasks
Sum together the majsub and minsub into a new column called total_substrate. Does total_substrate sum to 1 for all observations?
Change the riffle values of 1 and 2 to Riffle 1 and Riffle 2.
Change the length data from centimeters to millimeters. It is more common to use mm for small fishes.
Change the sex values of f and m to Female and Male.
Only total_substrate needs a new column. The other changes should use their own columns.


```{r}
(darters_wrangled <- darters_data %>%
  mutate(total_substrate = majsub + minsub,
         riffle = ifelse(riffle == "1",
                         "Riffle 1",
                         "Riffle 2"),
         length = length * 10,
         sex = ifelse(sex == "f", "Female", "Male")
         ))
```

Does total_substrate sum to 1 for all observations?

```{r}
darters_wrangled$total_substrate == 1
```
Yes, all of the sums are equal to 1 for total_substrate.


*Summarize data and Table results*

Use group_by() and summarize() to summarize the mean length, depth, and velocity for each species for each riffle. Save this summary to a different object than the original data. You will need both in the following plot. Use facet_wrap on riffles like you did in the last assignment.

```{r}
(darters_summary <- darters_wrangled %>%
  group_by(riffle, species) %>%
  summarise(length = mean(length, na.rm = TRUE),
            depth = mean(depth, na.rm = TRUE),
            velocity = mean(velocity, na.rm = TRUE)))
kable(darters_summary)
```


*Graph data*

**Plot 1**

Make a plot that uses the stat_summary() technique shown in R4ds section 3.7, reason 3 (scroll down, just before 3.7.1 Exercises) but use x = species and y = length.

This will plot a point to show the median length, and draw a line from the shortest (min) to the longest (max) length to show the range of lengths for each species.

```{r}
darters_wrangled %>%
  filter(!is.na(length)) %>%
  ggplot(mapping = aes(x = species, y = length)) +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
    ) +
  geom_point(data = darters_summary,
             mapping = aes(x = species,
                           y = length),
             shape = 15,
             color = "red") +
  facet_wrap(~ riffle) +
  coord_flip() +
  labs(y = "Length(in mm)", x = NULL)
  
   
  
```

The range of blennioides is largest in riffle 2 (among species) and smallest in riffle 1 (among other species). Range of spectabile and cearuleum is similar to each other (in their respective riffles). Mean of length is less than median in riffle 1 and greater than median in riffle 2. 

**Plot 2**

Make a new plot with a geom_point() layer of the length variable for each species. Change the point color to a lighter shade in the range of gray50 to gray70. The points should contrast against the overall gray background but they are not the main visual focus of the graph.
Add a stat_summary() layer with these arguments:
fun.y = median
geom = "point"
size = 2.2
Add another stat_summary(). Change the y function to mean, size to 3, and add the color = "maroon" argument.
Facet, label, and flip the graph as you did above.

```{r}
darters_wrangled %>%
  filter(!is.na(length)) %>%
  ggplot(mapping = aes(x = species,
                       y = length)) +
  geom_point(color = "gray60") +
  stat_summary(fun.y = median,
               geom = "point",
               size = 2.2) +
  stat_summary(fun.y = mean,
               geom = "point",
               size = 3,
               color = "maroon") +
  facet_wrap(~ riffle) +
  coord_flip() +
  labs(y = "Length(in mm)", x = NULL)
```

#####################
Not sure if data used is correct, also have to describe plots. 
Use of geom = "point"?
Arguments in plot 1 stat_summary not sure?




###############

***
#### Stress and corticosterones in birds












































































